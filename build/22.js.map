{"version":3,"sources":["../../src/pages/profile/profile-settings.module.ts","../../src/pages/profile/profile-settings.ts"],"names":[],"mappings":"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","file":"22.js","sourcesContent":["import { ProfileSettingsPage } from './profile-settings';\r\nimport { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    ProfileSettingsPage,\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(ProfileSettingsPage),\r\n  ],\r\n  exports: [\r\n    ProfileSettingsPage\r\n  ]\r\n})\r\n\r\nexport class ProfileSettingsPageModule { }\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/profile/profile-settings.module.ts","import {UserService} from \"../../providers/user.service\";\r\nimport {Component} from '@angular/core';\r\nimport {Camera} from '@ionic-native/camera';\r\nimport {AlertController, IonicPage, MenuController, NavController, NavParams, ToastController} from 'ionic-angular';\r\nimport {AppState} from \"../../app/global.setting\";\r\nimport {Geolocation} from '@ionic-native/geolocation';\r\n\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-profile-settings',\r\n  templateUrl: 'profile-settings.html',\r\n})\r\n\r\nexport class ProfileSettingsPage {\r\n  errorMessage: any;\r\n  placeholderPicture = 'assets/img/avatar/user-avatar.png';\r\n\r\n  profil: any = {};\r\n\r\n  languages = ['English'];\r\n  paymentMethods = ['ETH', 'BTC'];\r\n  currencies = ['USD', 'EUR'];\r\n\r\n  displayUpdate = false;\r\n\r\n  isNew = false;\r\n\r\n  isPass = false;\r\n  alive: boolean = true;\r\n\r\n  constructor(\r\n    public userService: UserService,\r\n    public toastCtrl: ToastController,\r\n    public camera: Camera,\r\n    public navCtrl: NavController,\r\n    public params: NavParams,\r\n    public global: AppState,\r\n    public menuCtrl: MenuController,\r\n    public geolocation: Geolocation,\r\n    public alertCtrl: AlertController\r\n  ) { }\r\n\r\n  ionViewWillEnter() {\r\n    if(this.params.get(\"isNew\")) {\r\n      this.isNew = true;\r\n      this.profil.language = this.languages[0];\r\n    }\r\n\r\n    if(this.userService._profil && !this.isNew) {\r\n      this.profil = this.userService._profil;\r\n    }\r\n  }\r\n\r\n  ionViewWillLeave() {\r\n    this.alive = false;\r\n  }\r\n\r\n  updateProfileImage() {\r\n    this.camera.getPicture({\r\n      quality: 50,\r\n      allowEdit: true,\r\n      cameraDirection: this.camera.Direction.FRONT,\r\n      destinationType: this.camera.DestinationType.DATA_URL,\r\n      encodingType: this.camera.EncodingType.JPEG,\r\n      mediaType: this.camera.MediaType.PICTURE\r\n    }).then((imageData) => {\r\n      this.profil.imageUrl = \"data:image/jpeg;base64,\" + imageData;\r\n      this.update();\r\n    }, (err) => {\r\n      this.toastCtrl.create('Error: ' + err);\r\n    });\r\n  }\r\n\r\n  updateData() {\r\n    if(!this.checkForm()) {\r\n      return false;\r\n    }\r\n\r\n    if(!this.isNew) {\r\n      this.profil.uid = this.userService._userFirebase.uid;\r\n      this.profil.username = this.userService._user.username;\r\n      this.isPass = true;\r\n      this.userService.saveProfil(this.profil);\r\n      this.userService._profil = this.profil;\r\n\r\n      this.toastCtrl.create({\r\n        message: 'Profil updated',\r\n        duration: 2000,\r\n        position: 'bottom'\r\n      }).present();\r\n\r\n      if(!this.isNew) {\r\n        this.navCtrl.pop();\r\n      }\r\n      return true;\r\n    } else {\r\n      this.userService.getUidFromPseudo(this.profil.pseudo)\r\n        .takeWhile(() => this.alive)\r\n        .subscribe(uid => {\r\n        if(!uid.$value || !this.isNew) {\r\n          this.profil.uid = this.userService._userFirebase.uid;\r\n          this.profil.username = this.userService._user.username;\r\n          this.isPass = true;\r\n          this.userService.saveProfil(this.profil);\r\n          this.userService._profil = this.profil;\r\n          this.global.set('profil', this.profil);\r\n\r\n          this.toastCtrl.create({\r\n            message: 'Profil updated',\r\n            duration: 2000,\r\n            position: 'bottom'\r\n          }).present();\r\n\r\n          if(!this.isNew) {\r\n            this.navCtrl.pop();\r\n          }\r\n\r\n          this.menuCtrl.enable(true, 'menu-material');\r\n          this.navCtrl.setRoot('TabsPage');\r\n          return true;\r\n        } else {\r\n          if(!this.isPass) {\r\n            let toast = this.toastCtrl.create({\r\n              message: 'Pseudo already used, choose a new one',\r\n              duration: 2000,\r\n              position: 'bottom'\r\n            });\r\n            toast.present(toast);\r\n            return false;\r\n          }\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  checkForm() {\r\n    if(!this.profil.pseudo || !this.profil.lastName || !this.profil.firstName || !this.profil.language || !this.profil.paymentMethod || !this.profil.currency) {\r\n      this.toastCtrl.create({\r\n        message: 'Please fill all fields',\r\n        duration: 2000,\r\n        position: 'bottom'\r\n      }).present();\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  update() {\r\n    if(!this.isNew) {\r\n      this.displayUpdate = true;\r\n    }\r\n  }\r\n\r\n  next() {\r\n    this.updateData();\r\n  }\r\n\r\n  checkPseudo() {\r\n    return this.userService.getUidFromPseudo(this.profil.pseudo)\r\n      .takeWhile(() => this.alive)\r\n      .subscribe(uid => {\r\n      if(uid.$value) {\r\n        if(!this.isPass) {\r\n          this.toastCtrl.create({\r\n            message: 'Pseudo already used, choose a new one',\r\n            duration: 2000,\r\n            position: 'bottom'\r\n          }).present();\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  showFiatEchange() {\r\n    if (this.profil.position) {\r\n      let confirm = this.alertCtrl.create({\r\n        title: 'Fiat exchange',\r\n        message: 'Your position will be displayed on the map.',\r\n        cssClass: 'confirm-alert',\r\n        buttons: [\r\n          {\r\n            text: 'Cancel',\r\n            handler: () => {\r\n              //console.log('Disagree clicked');\r\n            }\r\n          },\r\n          {\r\n            text: 'Confirm',\r\n            handler: () => {\r\n              this.geolocation.getCurrentPosition({ maximumAge: 30000, timeout: 3000, enableHighAccuracy: true })\r\n                .then((position) => {\r\n                  this.profil.position = true;\r\n                  this.userService.saveProfilPosition(\r\n                    position.coords.latitude + Math.random() * (0.0019 + 0.0019) - 0.0019,\r\n                    position.coords.longitude + Math.random() * (0.0019 + 0.0019) - 0.0019);\r\n                  if(!this.isNew) {\r\n                    this.userService.saveProfil(this.profil);\r\n                  }\r\n                }).catch((error) => {\r\n                //console.log('Error : ', error);\r\n                const alert = this.alertCtrl.create({\r\n                  title: 'Error',\r\n                  subTitle: 'Error while getting your position, try again',\r\n                  buttons: ['Close']\r\n                });\r\n                alert.present();\r\n              });\r\n            }\r\n          }\r\n        ]\r\n      });\r\n      confirm.present();\r\n    } else {\r\n      this.profil.position = false;\r\n      this.userService.deleteProfilPosition();\r\n      if(!this.isNew) {\r\n        this.userService.saveProfil(this.profil);\r\n      }\r\n    }\r\n  }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/profile/profile-settings.ts"],"sourceRoot":""}
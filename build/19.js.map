{"version":3,"sources":["../../src/pages/service/modalpopup/modal-service-action.module.ts","../../src/pages/service/modalpopup/modal-service-action.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;AAAuC;AACO;AACY;AAa1D,IAAa,wBAAwB;IAArC;IAAuC,CAAC;IAAD,+BAAC;AAAD,CAAC;AAA3B,wBAAwB;IAXpC,uEAAQ,CAAC;QACR,YAAY,EAAE;YACZ,iFAAkB;SACnB;QACD,OAAO,EAAE;YACP,sEAAe,CAAC,QAAQ,CAAC,iFAAkB,CAAC;SAC7C;QACD,OAAO,EAAE;YACP,iFAAkB;SACnB;KACF,CAAC;GACW,wBAAwB,CAAG;AAAH;;;;;;;;;;;;;;;;;;;;;;;;;;ACfG;AACsF;AAC9D;AAEU;AACd;AACkB;AACZ;AAOlE,IAAa,kBAAkB;IAc7B,4BACS,SAAyB,EACxB,SAA0B,EAC1B,aAA4B,EAC7B,QAAkB,EAClB,MAAiB,EACjB,QAAwB,EACxB,kBAAsC,EACtC,cAA8B,EAC9B,OAAsB,EACrB,WAAwB,EACxB,oBAA0C;QAXpD,iBA2CC;QA1CQ,cAAS,GAAT,SAAS,CAAgB;QACxB,cAAS,GAAT,SAAS,CAAiB;QAC1B,kBAAa,GAAb,aAAa,CAAe;QAC7B,aAAQ,GAAR,QAAQ,CAAU;QAClB,WAAM,GAAN,MAAM,CAAW;QACjB,aAAQ,GAAR,QAAQ,CAAgB;QACxB,uBAAkB,GAAlB,kBAAkB,CAAoB;QACtC,mBAAc,GAAd,cAAc,CAAgB;QAC9B,YAAO,GAAP,OAAO,CAAe;QACrB,gBAAW,GAAX,WAAW,CAAa;QACxB,yBAAoB,GAApB,oBAAoB,CAAsB;QAvBpD,YAAO,GAAQ,EAAE,CAAC;QAClB,aAAQ,GAAG,EAAE,CAAC;QAMd,SAAI,GAAQ,CAAC,CAAC;QAEd,eAAU,GAAQ,CAAC,CAAC;QACpB,UAAK,GAAY,IAAI,CAAC;QAgBpB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QACxC,EAAE,EAAC,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;YAC9B,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;QAC5C,CAAC;QAAC,IAAI,CAAC,CAAC;YACN,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;YACtD,IAAI,CAAC,cAAc,CAAC,gBAAgB,CAAC,IAAI,CAAC,cAAc,CAAC,SAAS,CAAC;iBAChE,SAAS,CAAC,cAAM,YAAI,CAAC,KAAK,EAAV,CAAU,CAAC;iBAC3B,SAAS,CAAC,cAAI;gBACjB,KAAI,CAAC,OAAO,GAAG,IAAI,CAAC;YACtB,CAAC,CAAC,CAAC;YAEH,EAAE,EAAC,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC,CAAC;gBAClC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC;YACnD,CAAC;YAED,EAAE,EAAC,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC,CAAC;gBAClC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC;YACnD,CAAC;QACH,CAAC;QAED,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QACvC,IAAI,CAAC,MAAM,CAAC,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;QAEjD,IAAI,CAAC,oBAAoB,CAAC,aAAa,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC;aACzD,SAAS,CAAC,cAAM,YAAI,CAAC,KAAK,EAAV,CAAU,CAAC;aAC3B,SAAS,CAAC,cAAI;YACb,KAAI,CAAC,IAAI,GAAG,IAAI,CAAC,KAAI,CAAC,WAAW,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;YACpD,KAAI,CAAC,QAAQ,GAAG,KAAI,CAAC,WAAW,CAAC,OAAO,CAAC,QAAQ,CAAC;QACpD,CAAC,CAAC,CAAC;IACP,CAAC;IAED,oCAAO,GAAP,UAAQ,MAAM;QACZ,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QACnB,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;IAChC,CAAC;IAED,kCAAK,GAAL;QACE,EAAE,EAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;YACvC,IAAM,OAAK,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;gBAClC,KAAK,EAAE,SAAS;gBAChB,QAAQ,EAAE,wBAAwB;gBAClC,OAAO,EAAE,CAAC,OAAO,CAAC;aACnB,CAAC,CAAC;YACH,OAAK,CAAC,OAAO,EAAE,CAAC;YAChB,MAAM,CAAC,KAAK,CAAC;QACf,CAAC;QAED,EAAE,EAAC,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,IAAI,CAAC,CAAC,CAAC,CAAC;YAC/B,IAAM,OAAK,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;gBAClC,KAAK,EAAE,SAAS;gBAChB,QAAQ,EAAE,yBAAyB;gBACnC,OAAO,EAAE,CAAC,OAAO,CAAC;aACnB,CAAC,CAAC;YACH,OAAK,CAAC,OAAO,EAAE,CAAC;YAChB,MAAM,CAAC,KAAK,CAAC;QACf,CAAC;QAED,EAAE,EAAC,IAAI,CAAC,OAAO,CAAC,GAAG,IAAI,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC,CAAC;YAC1D,IAAM,OAAK,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;gBAClC,KAAK,EAAE,OAAO;gBACd,QAAQ,EAAE,kCAAkC;gBAC5C,OAAO,EAAE,CAAC,OAAO,CAAC;aACnB,CAAC,CAAC;YACH,OAAK,CAAC,OAAO,EAAE,CAAC;YAChB,MAAM,CAAC;QACT,CAAC;QAED,IAAI,CAAC,cAAc,CAAC,gBAAgB,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;QAC5F,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;QACxB,IAAI,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;YAChC,OAAO,EAAE,uCAAuC;YAChD,QAAQ,EAAE,IAAI;YACd,QAAQ,EAAE,QAAQ;SACnB,CAAC,CAAC;QAEH,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;IACvB,CAAC;IAED,gCAAG,GAAH;QAAA,iBA+DC;QA9DC,EAAE,EAAC,IAAI,CAAC,OAAO,CAAC,GAAG,IAAI,IAAI,CAAC,WAAW,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC,CAAC;YAC1D,IAAM,OAAK,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;gBAClC,KAAK,EAAE,OAAO;gBACd,QAAQ,EAAE,gCAAgC;gBAC1C,OAAO,EAAE,CAAC,OAAO,CAAC;aACnB,CAAC,CAAC;YACH,OAAK,CAAC,OAAO,EAAE,CAAC;YAChB,MAAM,CAAC;QACT,CAAC;QAED,IAAI,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC;YACjC,KAAK,EAAE,qBAAqB;YAC5B,QAAQ,EAAE,qBAAqB;YAC/B,QAAQ,EAAE,aAAa;YACvB,MAAM,EAAE;gBACN;oBACE,IAAI,EAAE,UAAU;oBAChB,WAAW,EAAE,UAAU;oBACvB,IAAI,EAAE,UAAU;iBACjB;aACF;YACD,OAAO,EAAE;gBACP;oBACE,IAAI,EAAE,QAAQ;oBACd,OAAO,EAAE,cAAI;wBACX,gCAAgC;oBAClC,CAAC;iBACF;gBACD;oBACE,IAAI,EAAE,UAAU;oBAChB,OAAO,EAAE,cAAI;wBACX,oBAAoB;wBACpB,KAAI,CAAC,aAAa,CAAC,UAAU,CAAC,KAAI,CAAC,OAAO,CAAC,GAAG,CAAC;6BAC5C,SAAS,CAAC,cAAM,YAAI,CAAC,KAAK,EAAV,CAAU,CAAC;6BAC3B,SAAS,CAAC,iBAAO;4BAClB,GAAG,CAAC,CAAY,UAAoB,EAApB,WAAM,CAAC,IAAI,CAAC,OAAO,CAAC,EAApB,cAAoB,EAApB,IAAoB;gCAA/B,IAAI,GAAG;gCACV,KAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,WAAW,EAAE,CAAC,GAAG,OAAO,CAAC,GAAG,CAAC,CAAC;6BACjD;4BAED,KAAI,CAAC,OAAO,CAAC,EAAE,GAAG,KAAI,CAAC,SAAS,CAAC;4BACjC,KAAI,CAAC,OAAO,CAAC,OAAO,GAAG,KAAI,CAAC,OAAO,CAAC;4BACpC,KAAI,CAAC,OAAO,CAAC,IAAI,GAAG,KAAI,CAAC,IAAI,CAAC;4BAC9B,KAAI,CAAC,OAAO,CAAC,OAAO,GAAG,KAAI,CAAC,OAAO,CAAC;4BAEpC,KAAI,CAAC,kBAAkB,CAAC,UAAU,CAChC,KAAI,CAAC,WAAW,CAAC,OAAO,CAAC,aAAa,EACtC,KAAI,CAAC,MAAM,EACX,KAAI,CAAC,QAAQ,CAAC,KAAI,CAAC,WAAW,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC,OAAO,EAC7D,KAAI,CAAC,OAAO,CAAC,KAAK,GAAG,KAAI,CAAC,UAAU,GAAG,KAAI,CAAC,IAAI,EAChD,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,EACpB,aAAa,EACb,KAAI,CAAC,OAAO,EACZ,KAAI,CAAC,cAAc,CACpB,CAAC;4BAEF,KAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;wBAC1B,CAAC,CAAC,CAAC;oBACL,CAAC;iBACF;aACF;SACF,CAAC,CAAC;QACH,MAAM,CAAC,OAAO,EAAE,CAAC;IACnB,CAAC;IAEH,yBAAC;AAAD,CAAC;AA3KY,kBAAkB;IAL9B,wEAAS,EAAE;IACX,wEAAS,CAAC;QACT,QAAQ,EAAE,2BAA2B;OACG;KACzC,CAAC;+EAgBkC;QACb,iFAAe;QACX,gEAAa;QACnB,gEAAQ;QACV,qEAAS;QACP,0FAAc;QACJ,mFAAkB;QACtB,qEAAc;QACrB,6EAAa;QACR,8FAAW;QACF,eAAoB;AAkJrD;SA3KY,kBAAkB,qB","file":"19.js","sourcesContent":["import {NgModule} from '@angular/core';\r\nimport {IonicPageModule} from 'ionic-angular';\r\nimport {ModalServiceAction} from \"./modal-service-action\";\r\n\r\n@NgModule({\r\n  declarations: [\r\n    ModalServiceAction\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(ModalServiceAction),\r\n  ],\r\n  exports: [\r\n    ModalServiceAction\r\n  ]\r\n})\r\nexport class ModalServiceActionModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/service/modalpopup/modal-service-action.module.ts","import {Component} from '@angular/core';\nimport {AlertController, IonicPage, NavController, NavParams, Platform, ViewController, ToastController} from 'ionic-angular';\nimport {WalletService} from \"../../../providers/wallet.service\";\nimport {Wallet} from \"../../../providers/model/wallet\";\nimport {TransactionService} from \"../../../providers/transaction.service\";\nimport {UserService} from \"../../../providers/user.service\";\nimport {CryptocompareService} from \"../../../providers/cryptocompare.service\";\nimport {ArticleService} from \"../../../providers/article.service\";\n\n@IonicPage()\n@Component({\n  selector: 'page-modal-action-service',\n  templateUrl: 'modal-service-action.html'\n})\nexport class ModalServiceAction {\n  wallet: Wallet;\n  service: any = {};\n  walletTo = {};\n  serviceId: any;\n  rate: any;\n  currency: any;\n  comment: any;\n  address: any;\n  hour: any = 1;\n  serviceOrdered: any;\n  nbHourDone: any = 1;\n  alive: boolean = true;\n\n  constructor(\n    public toastCtrl:ToastController,\n    private alertCtrl: AlertController,\n    private walletService: WalletService,\n    public platform: Platform,\n    public params: NavParams,\n    public viewCtrl: ViewController,\n    public transactionService: TransactionService,\n    public articleService: ArticleService,\n    public navCtrl: NavController,\n    private userService: UserService,\n    private cryptocompareService: CryptocompareService\n  ) {\n\n    this.wallet = this.params.get('wallet');\n    if(this.params.get('service')) {\n      this.service = this.params.get('service');\n    } else {\n      this.serviceOrdered = this.params.get('serviceOrdered');\n        this.articleService.getServiceFromId(this.serviceOrdered.serviceId)\n          .takeWhile(() => this.alive)\n          .subscribe(data => {\n        this.service = data;\n      });\n\n      if(this.serviceOrdered.nbEstimate) {\n        this.nbHourDone = this.serviceOrdered.nbEstimate;\n      }\n\n      if(this.serviceOrdered.nbHourReal) {\n        this.nbHourDone = this.serviceOrdered.nbHourReal;\n      }\n    }\n\n    this.serviceId = this.params.get('id');\n    this.wallet.trigram = this.params.get(\"trigram\");\n\n    this.cryptocompareService.getRateCrypto(this.wallet.trigram)\n      .takeWhile(() => this.alive)\n      .subscribe(data => {\n        this.rate = data[this.userService._profil.currency];\n        this.currency = this.userService._profil.currency;\n      });\n  }\n\n  dismiss(status) {\n    this.alive = false;\n    this.viewCtrl.dismiss(status);\n  }\n\n  order() {\n    if(this.service.isHourly && !this.hour) {\n      const alert = this.alertCtrl.create({\n        title: 'Error !',\n        subTitle: 'Fill an estimated hour',\n        buttons: ['Close']\n      });\n      alert.present();\n      return false;\n    }\n\n    if(this.hour && this.hour <= 0) {\n      const alert = this.alertCtrl.create({\n        title: 'Error !',\n        subTitle: 'No valid estimated hour',\n        buttons: ['Close']\n      });\n      alert.present();\n      return false;\n    }\n\n    if(this.service.uid == this.userService._userFirebase.uid) {\n      const alert = this.alertCtrl.create({\n        title: 'Error',\n        subTitle: \"You can't order your own service\",\n        buttons: ['Close']\n      });\n      alert.present();\n      return;\n    }\n\n    this.articleService.saveServiceOrder(this.serviceId, this.service, this.comment, this.hour);\n    this.dismiss(\"success\");\n    let toast = this.toastCtrl.create({\n      message: 'Service ordered.\\nContact the vendor.',\n      duration: 5000,\n      position: 'bottom'\n    });\n\n    toast.present(toast);\n  }\n\n  pay() {\n    if(this.service.uid == this.userService._userFirebase.uid) {\n      const alert = this.alertCtrl.create({\n        title: 'Error',\n        subTitle: \"You can't pay your own service\",\n        buttons: ['Close']\n      });\n      alert.present();\n      return;\n    }\n\n    let prompt = this.alertCtrl.create({\n      title: 'Confirm transaction',\n      subTitle: 'Enter your password',\n      cssClass: 'promt-alert',\n      inputs: [\n        {\n          name: 'password',\n          placeholder: 'Password',\n          type: 'password'\n        },\n      ],\n      buttons: [\n        {\n          text: 'Cancel',\n          handler: data => {\n            //console.log('Cancel clicked');\n          }\n        },\n        {\n          text: 'Validate',\n          handler: data => {\n            //TODO check content\n            this.walletService.getWallets(this.service.uid)\n              .takeWhile(() => this.alive)\n              .subscribe(content => {\n              for (let key of Object.keys(content)) {\n                this.walletTo[key.toUpperCase()] = content[key];\n              }\n\n              this.service.id = this.serviceId;\n              this.service.comment = this.comment;\n              this.service.hour = this.hour;\n              this.service.address = this.address;\n\n              this.transactionService.payService(\n                this.userService._profil.paymentMethod,\n                this.wallet,\n                this.walletTo[this.userService._profil.paymentMethod].address,\n                this.service.price * this.nbHourDone / this.rate,\n                data.password.trim(),\n                \"Pay service\",\n                this.service,\n                this.serviceOrdered\n              );\n\n              this.dismiss(\"success\");\n            });\n          }\n        }\n      ]\n    });\n    prompt.present();\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/service/modalpopup/modal-service-action.ts"],"sourceRoot":""}
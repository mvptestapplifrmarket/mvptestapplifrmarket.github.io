{"version":3,"sources":["../../src/pages/service/modalpopup/modal-service-action.module.ts","../../src/pages/service/modalpopup/modal-service-action.ts"],"names":[],"mappings":"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","file":"19.js","sourcesContent":["import {NgModule} from '@angular/core';\r\nimport {IonicPageModule} from 'ionic-angular';\r\nimport {ModalServiceAction} from \"./modal-service-action\";\r\n\r\n@NgModule({\r\n  declarations: [\r\n    ModalServiceAction\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(ModalServiceAction),\r\n  ],\r\n  exports: [\r\n    ModalServiceAction\r\n  ]\r\n})\r\nexport class ModalServiceActionModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/service/modalpopup/modal-service-action.module.ts","import {Component} from '@angular/core';\r\nimport {AlertController, IonicPage, NavController, NavParams, Platform, ViewController, ToastController} from 'ionic-angular';\r\nimport {WalletService} from \"../../../providers/wallet.service\";\r\nimport {Wallet} from \"../../../providers/model/wallet\";\r\nimport {TransactionService} from \"../../../providers/transaction.service\";\r\nimport {UserService} from \"../../../providers/user.service\";\r\nimport {CryptocompareService} from \"../../../providers/cryptocompare.service\";\r\nimport {ArticleService} from \"../../../providers/article.service\";\r\n\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-modal-action-service',\r\n  templateUrl: 'modal-service-action.html'\r\n})\r\nexport class ModalServiceAction {\r\n  wallet: Wallet;\r\n  service: any = {};\r\n  walletTo = {};\r\n  serviceId: any;\r\n  rate: any;\r\n  currency: any;\r\n  comment: any;\r\n  address: any;\r\n  hour: any = 1;\r\n  serviceOrdered: any;\r\n  nbHourDone: any = 1;\r\n  alive: boolean = true;\r\n\r\n  constructor(\r\n    public toastCtrl:ToastController,\r\n    private alertCtrl: AlertController,\r\n    private walletService: WalletService,\r\n    public platform: Platform,\r\n    public params: NavParams,\r\n    public viewCtrl: ViewController,\r\n    public transactionService: TransactionService,\r\n    public articleService: ArticleService,\r\n    public navCtrl: NavController,\r\n    private userService: UserService,\r\n    private cryptocompareService: CryptocompareService\r\n  ) {\r\n\r\n    this.wallet = this.params.get('wallet');\r\n    if(this.params.get('service')) {\r\n      this.service = this.params.get('service');\r\n    } else {\r\n      this.serviceOrdered = this.params.get('serviceOrdered');\r\n        this.articleService.getServiceFromId(this.serviceOrdered.serviceId)\r\n          .takeWhile(() => this.alive)\r\n          .subscribe(data => {\r\n        this.service = data;\r\n      });\r\n\r\n      if(this.serviceOrdered.nbEstimate) {\r\n        this.nbHourDone = this.serviceOrdered.nbEstimate;\r\n      }\r\n\r\n      if(this.serviceOrdered.nbHourReal) {\r\n        this.nbHourDone = this.serviceOrdered.nbHourReal;\r\n      }\r\n    }\r\n\r\n    this.serviceId = this.params.get('id');\r\n    this.wallet.trigram = this.params.get(\"trigram\");\r\n\r\n    this.cryptocompareService.getRateCrypto(this.wallet.trigram)\r\n      .takeWhile(() => this.alive)\r\n      .subscribe(data => {\r\n        this.rate = data[this.userService._profil.currency];\r\n        this.currency = this.userService._profil.currency;\r\n      });\r\n  }\r\n\r\n  dismiss(status) {\r\n    this.alive = false;\r\n    this.viewCtrl.dismiss(status);\r\n  }\r\n\r\n  order() {\r\n    if(this.service.isHourly && !this.hour) {\r\n      const alert = this.alertCtrl.create({\r\n        title: 'Error !',\r\n        subTitle: 'Fill an estimated hour',\r\n        buttons: ['Close']\r\n      });\r\n      alert.present();\r\n      return false;\r\n    }\r\n\r\n    if(this.hour && this.hour <= 0) {\r\n      const alert = this.alertCtrl.create({\r\n        title: 'Error !',\r\n        subTitle: 'No valid estimated hour',\r\n        buttons: ['Close']\r\n      });\r\n      alert.present();\r\n      return false;\r\n    }\r\n\r\n    if(this.service.uid == this.userService._userFirebase.uid) {\r\n      const alert = this.alertCtrl.create({\r\n        title: 'Error',\r\n        subTitle: \"You can't order your own service\",\r\n        buttons: ['Close']\r\n      });\r\n      alert.present();\r\n      return;\r\n    }\r\n\r\n    this.articleService.saveServiceOrder(this.serviceId, this.service, this.comment, this.hour);\r\n    this.dismiss(\"success\");\r\n    let toast = this.toastCtrl.create({\r\n      message: 'Service ordered.\\nContact the vendor.',\r\n      duration: 5000,\r\n      position: 'bottom'\r\n    });\r\n\r\n    toast.present(toast);\r\n  }\r\n\r\n  pay() {\r\n    if(this.service.uid == this.userService._userFirebase.uid) {\r\n      const alert = this.alertCtrl.create({\r\n        title: 'Error',\r\n        subTitle: \"You can't pay your own service\",\r\n        buttons: ['Close']\r\n      });\r\n      alert.present();\r\n      return;\r\n    }\r\n\r\n    let prompt = this.alertCtrl.create({\r\n      title: 'Confirm transaction',\r\n      subTitle: 'Enter your password',\r\n      cssClass: 'promt-alert',\r\n      inputs: [\r\n        {\r\n          name: 'password',\r\n          placeholder: 'Password',\r\n          type: 'password'\r\n        },\r\n      ],\r\n      buttons: [\r\n        {\r\n          text: 'Cancel',\r\n          handler: data => {\r\n            //console.log('Cancel clicked');\r\n          }\r\n        },\r\n        {\r\n          text: 'Validate',\r\n          handler: data => {\r\n            //TODO check content\r\n            this.walletService.getWallets(this.service.uid)\r\n              .takeWhile(() => this.alive)\r\n              .subscribe(content => {\r\n              for (let key of Object.keys(content)) {\r\n                this.walletTo[key.toUpperCase()] = content[key];\r\n              }\r\n\r\n              this.service.id = this.serviceId;\r\n              this.service.comment = this.comment;\r\n              this.service.hour = this.hour;\r\n              this.service.address = this.address;\r\n\r\n              this.transactionService.payService(\r\n                this.userService._profil.paymentMethod,\r\n                this.wallet,\r\n                this.walletTo[this.userService._profil.paymentMethod].address,\r\n                this.service.price * this.nbHourDone / this.rate,\r\n                data.password.trim(),\r\n                \"Pay service\",\r\n                this.service,\r\n                this.serviceOrdered\r\n              );\r\n\r\n              this.dismiss(\"success\");\r\n            });\r\n          }\r\n        }\r\n      ]\r\n    });\r\n    prompt.present();\r\n  }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/service/modalpopup/modal-service-action.ts"],"sourceRoot":""}
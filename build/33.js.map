{"version":3,"sources":["../../src/pages/article/modalpopup/modal-article-action.module.ts","../../src/pages/article/modalpopup/modal-article-action.ts"],"names":[],"mappings":"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","file":"33.js","sourcesContent":["import {NgModule} from '@angular/core';\r\nimport {IonicPageModule} from 'ionic-angular';\r\nimport {ModalArticleAction} from \"./modal-article-action\";\r\n\r\n@NgModule({\r\n  declarations: [\r\n    ModalArticleAction\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(ModalArticleAction)\r\n  ],\r\n  exports: [\r\n    ModalArticleAction\r\n  ]\r\n})\r\nexport class ModalArticleActionModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/article/modalpopup/modal-article-action.module.ts","import {Component} from '@angular/core';\r\nimport {AlertController, IonicPage, NavController, NavParams, Platform, ViewController} from 'ionic-angular';\r\nimport {WalletService} from \"../../../providers/wallet.service\";\r\nimport {Wallet} from \"../../../providers/model/wallet\";\r\nimport {TransactionService} from \"../../../providers/transaction.service\";\r\nimport {UserService} from \"../../../providers/user.service\";\r\nimport {CryptocompareService} from \"../../../providers/cryptocompare.service\";\r\nimport {ArticleService} from \"../../../providers/article.service\";\r\n\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-modal-action-article',\r\n  templateUrl: 'modal-article-action.html'\r\n})\r\nexport class ModalArticleAction {\r\n  wallet: Wallet;\r\n  article: any = {};\r\n  walletTo = {};\r\n  isInventory: any;\r\n  articleId: any;\r\n  rate: any;\r\n  currency: any;\r\n  alive: boolean = true;\r\n\r\n  constructor(\r\n    private alertCtrl: AlertController,\r\n    private walletService: WalletService,\r\n    public platform: Platform,\r\n    public params: NavParams,\r\n    public viewCtrl: ViewController,\r\n    public transactionService: TransactionService,\r\n    public navCtrl: NavController,\r\n    private userService: UserService,\r\n    private cryptocompareService: CryptocompareService,\r\n    private articleService: ArticleService\r\n  ) {\r\n\r\n    this.wallet = this.params.get('wallet');\r\n    this.article = this.params.get('article');\r\n    this.articleId = this.params.get('id');\r\n    this.isInventory = params.get('isInventory');\r\n    this.wallet.trigram = this.params.get(\"trigram\");\r\n\r\n    this.cryptocompareService.getRateCrypto(this.wallet.trigram)\r\n      .takeWhile(() => this.alive)\r\n      .subscribe(data => {\r\n        this.rate = data[this.userService._profil.currency];\r\n        this.currency = this.userService._profil.currency;\r\n      });\r\n\r\n  }\r\n\r\n  dismiss(status) {\r\n    this.alive = false;\r\n    this.viewCtrl.dismiss(status);\r\n  }\r\n\r\n  validate() {\r\n    if(this.article.uid == this.userService._userFirebase.uid) {\r\n      const alert = this.alertCtrl.create({\r\n        title: 'Error',\r\n        subTitle: \"You can't buy the article yourself\",\r\n        buttons: ['Close']\r\n      });\r\n      alert.present();\r\n      return;\r\n    }\r\n    let isPass = false;\r\n    this.articleService.getArticleFromId(this.articleId).takeWhile(() => this.alive).subscribe(data => {\r\n      if(!isPass) {\r\n        if(data.status == 'published') {\r\n          let prompt = this.alertCtrl.create({\r\n            title: 'Confirm transaction',\r\n            subTitle: 'Enter your password',\r\n            cssClass: 'promt-alert',\r\n            inputs: [\r\n              {\r\n                name: 'password',\r\n                placeholder: 'Password',\r\n                type: 'password'\r\n              },\r\n            ],\r\n            buttons: [\r\n              {\r\n                text: 'Cancel',\r\n                handler: data => {\r\n                  //console.log('Cancel clicked');\r\n                }\r\n              },\r\n              {\r\n                text: 'Validate',\r\n                handler: data => {\r\n                  //TODO check content\r\n                  this.walletService.getWallets(this.article.uid).takeWhile(() => this.alive).subscribe(content => {\r\n                    for (let key of Object.keys(content)) {\r\n                      this.walletTo[key.toUpperCase()] = content[key];\r\n                    }\r\n                    if(!this.isInventory) {\r\n                      this.transactionService.payArticle(\r\n                        this.userService._profil.paymentMethod,\r\n                        this.wallet,\r\n                        this.walletTo[this.userService._profil.paymentMethod].address,\r\n                        this.article.price / this.rate,\r\n                        data.password.trim(),\r\n                        \"Pay article\",\r\n                        this.article,\r\n                        this.articleId\r\n                      );\r\n                    } else {\r\n                      this.transactionService.payInventory(\r\n                        this.userService._profil.paymentMethod,\r\n                        this.wallet,\r\n                        this.walletTo[this.userService._profil.paymentMethod].address,\r\n                        this.article.price / this.rate,\r\n                        data.password.trim(),\r\n                        \"Pay inventory\",\r\n                        this.article\r\n                      );\r\n                    }\r\n\r\n                    this.dismiss(\"success\");\r\n                  });\r\n                }\r\n              }\r\n            ]\r\n          });\r\n          prompt.present();\r\n        } else {\r\n          const alert = this.alertCtrl.create({\r\n            title: 'Error',\r\n            subTitle: 'Error article already bought',\r\n            buttons: ['Close']\r\n          });\r\n          alert.present();\r\n        }\r\n        isPass = true;\r\n      }\r\n\r\n    });\r\n  }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/article/modalpopup/modal-article-action.ts"],"sourceRoot":""}
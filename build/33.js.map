{"version":3,"sources":["../../src/pages/article/modalpopup/modal-article-action.module.ts","../../src/pages/article/modalpopup/modal-article-action.ts"],"names":[],"mappings":"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","file":"33.js","sourcesContent":["import {NgModule} from '@angular/core';\r\nimport {IonicPageModule} from 'ionic-angular';\r\nimport {ModalArticleAction} from \"./modal-article-action\";\r\n\r\n@NgModule({\r\n  declarations: [\r\n    ModalArticleAction\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(ModalArticleAction)\r\n  ],\r\n  exports: [\r\n    ModalArticleAction\r\n  ]\r\n})\r\nexport class ModalArticleActionModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/article/modalpopup/modal-article-action.module.ts","import {Component} from '@angular/core';\nimport {AlertController, IonicPage, NavController, NavParams, Platform, ViewController} from 'ionic-angular';\nimport {WalletService} from \"../../../providers/wallet.service\";\nimport {Wallet} from \"../../../providers/model/wallet\";\nimport {TransactionService} from \"../../../providers/transaction.service\";\nimport {UserService} from \"../../../providers/user.service\";\nimport {CryptocompareService} from \"../../../providers/cryptocompare.service\";\nimport {ArticleService} from \"../../../providers/article.service\";\n\n@IonicPage()\n@Component({\n  selector: 'page-modal-action-article',\n  templateUrl: 'modal-article-action.html'\n})\nexport class ModalArticleAction {\n  wallet: Wallet;\n  article: any = {};\n  walletTo = {};\n  isInventory: any;\n  articleId: any;\n  rate: any;\n  currency: any;\n  alive: boolean = true;\n  address: any;\n\n  constructor(\n    private alertCtrl: AlertController,\n    private walletService: WalletService,\n    public platform: Platform,\n    public params: NavParams,\n    public viewCtrl: ViewController,\n    public transactionService: TransactionService,\n    public navCtrl: NavController,\n    private userService: UserService,\n    private cryptocompareService: CryptocompareService,\n    private articleService: ArticleService\n  ) {\n\n    this.wallet = this.params.get('wallet');\n    this.article = this.params.get('article');\n    this.articleId = this.params.get('id');\n    this.isInventory = params.get('isInventory');\n    this.wallet.trigram = this.params.get(\"trigram\");\n\n    this.cryptocompareService.getRateCrypto(this.wallet.trigram)\n      .takeWhile(() => this.alive)\n      .subscribe(data => {\n        this.rate = data[this.userService._profil.currency];\n        this.currency = this.userService._profil.currency;\n      });\n\n  }\n\n  dismiss(status) {\n    this.alive = false;\n    this.viewCtrl.dismiss(status);\n  }\n\n  validate() {\n    if(this.article.uid == this.userService._userFirebase.uid) {\n      const alert = this.alertCtrl.create({\n        title: 'Error',\n        subTitle: \"You can't buy the article yourself\",\n        buttons: ['Close']\n      });\n      alert.present();\n      return;\n    }\n    let isPass = false;\n    this.articleService.getArticleFromId(this.articleId).takeWhile(() => this.alive).subscribe(data => {\n      if(!isPass) {\n        if(data.status == 'published') {\n          let prompt = this.alertCtrl.create({\n            title: 'Confirm transaction',\n            subTitle: 'Enter your password',\n            cssClass: 'promt-alert',\n            inputs: [\n              {\n                name: 'password',\n                placeholder: 'Password',\n                type: 'password'\n              },\n            ],\n            buttons: [\n              {\n                text: 'Cancel',\n                handler: data => {\n                  //console.log('Cancel clicked');\n                }\n              },\n              {\n                text: 'Validate',\n                handler: data => {\n                  //TODO check content\n                  this.walletService.getWallets(this.article.uid).takeWhile(() => this.alive).subscribe(content => {\n                    for (let key of Object.keys(content)) {\n                      this.walletTo[key.toUpperCase()] = content[key];\n                    }\n                    if(!this.isInventory) {\n                      this.article.address = this.address;\n                      this.transactionService.payArticle(\n                        this.userService._profil.paymentMethod,\n                        this.wallet,\n                        this.walletTo[this.userService._profil.paymentMethod].address,\n                        this.article.price / this.rate,\n                        data.password.trim(),\n                        \"Pay article\",\n                        this.article,\n                        this.articleId\n                      );\n                    } else {\n                      this.article.address = this.article.latitude + \",\" + this.article.longitude;\n                      this.transactionService.payInventory(\n                        this.userService._profil.paymentMethod,\n                        this.wallet,\n                        this.walletTo[this.userService._profil.paymentMethod].address,\n                        this.article.price / this.rate,\n                        data.password.trim(),\n                        \"Pay inventory\",\n                        this.article\n                      );\n                    }\n\n                    this.dismiss(\"success\");\n                    this.article.status == 'sold'\n                  });\n                }\n              }\n            ]\n          });\n          prompt.present();\n        } else {\n          const alert = this.alertCtrl.create({\n            title: 'Error',\n            subTitle: 'Error article already bought',\n            buttons: ['Close']\n          });\n          alert.present();\n        }\n        isPass = true;\n      }\n\n    });\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/article/modalpopup/modal-article-action.ts"],"sourceRoot":""}